# ğŸ“˜ Next.js é«˜é¢‘é¢è¯•é¢˜ Â· å…¨å±•å¼€ç‰ˆï¼ˆ2025 ä¸­å›½å‰ç«¯ä¸“ç”¨ï¼‰

## ä¸€ã€åŸºç¡€ä¸æ ¸å¿ƒæ¦‚å¿µ

### 1. ä»€ä¹ˆæ˜¯ Next.jsï¼Ÿç›¸æ¯” CRA çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Next.js æ˜¯åŸºäº React çš„å…¨æ ˆæ¡†æ¶ï¼Œæ”¯æŒ SSR/SSG/ISRï¼Œå†…ç½®è·¯ç”±ä¸æ€§èƒ½ä¼˜åŒ–ï¼Œæ¯” CRA æ›´é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚

**è¦ç‚¹**

- åŸºäº Reactã€‚
- æ”¯æŒå¤šç§æ¸²æŸ“æ¨¡å¼ï¼ˆSSR / SSG / ISR / CSRï¼‰ã€‚
- å†…ç½®è·¯ç”±ã€APIã€æ€§èƒ½ä¼˜åŒ–ï¼ˆå›¾ç‰‡/å­—ä½“/ä»£ç åˆ†å‰²ï¼‰ã€‚
- CRA ä»…æ”¯æŒ CSRã€‚

**è¯¦ç»†å›ç­”**
CRA (create-react-app) åªæ”¯æŒ **CSR**ï¼Œé¦–å±æ…¢ã€ä¸åˆ© SEOã€‚
Next.js åœ¨ React åŸºç¡€ä¸Šæ‰©å±•äº†ï¼š

- **æ¸²æŸ“æ¨¡å¼å¤šæ ·**ï¼šæŒ‰éœ€é€‰æ‹© SSR/SSG/ISRã€‚
- **è·¯ç”±ç³»ç»Ÿ**ï¼šåŸºäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€/åµŒå¥—è·¯ç”±ã€‚
- **API Routes / Route Handlers**ï¼šå†…ç½®åç«¯æ¥å£èƒ½åŠ›ã€‚
- **ä¼˜åŒ–**ï¼šè‡ªåŠ¨ä»£ç åˆ†å‰²ã€å›¾ç‰‡/å­—ä½“ä¼˜åŒ–ã€æµå¼æ¸²æŸ“ã€‚
- **SEO**ï¼šæ„å»ºæ—¶å³å¯äº§å‡º HTMLï¼Œåˆ©äºæœç´¢å¼•æ“ã€‚

**æ‰©å±•/å¯¹æ¯”**

- **Next.js vs CRA**ï¼šæœ‰ SEO/æ€§èƒ½è¦æ±‚ â†’ Next.jsï¼›ä»…å†…ç½‘åå° â†’ CRA å¤Ÿç”¨ã€‚
- **Next.js vs Vite+React**ï¼šVite å¼€å‘ä½“éªŒæ›´å¿«ï¼Œä½† Next.js åœ¨ç”Ÿäº§çº§ SSR/ISRã€BFFã€è¾¹ç¼˜è®¡ç®—æ–¹é¢æ›´æˆç†Ÿã€‚
- **å›¢é˜Ÿåä½œ**ï¼šNext.js çº¦å®šä¼˜äºé…ç½®ï¼Œè§„èŒƒåŒ–æ›´å¼ºï¼Œäº¤ä»˜æ›´å¿«ã€‚

---

### 2. CSRã€SSRã€SSGã€ISR çš„åŒºåˆ«ä¸é€‚ç”¨åœºæ™¯ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
CSR å…¨åœ¨å‰ç«¯æ¸²æŸ“ï¼ŒSSR æœåŠ¡ç«¯å®æ—¶æ¸²æŸ“ï¼ŒSSG æ„å»ºæ—¶é™æ€åŒ–ï¼ŒISR åœ¨é™æ€åŸºç¡€ä¸Šå®šæœŸæ›´æ–°ã€‚

**è¦ç‚¹**

- CSRï¼šé¦–å±æ…¢ï¼Œäº¤äº’å¿«ã€‚
- SSRï¼šé¦–å±å¿«ï¼ŒSEO å¥½ï¼Œä½†æœåŠ¡å™¨å‹åŠ›å¤§ã€‚
- SSGï¼šæ€§èƒ½æœ€ä½³ï¼Œé€‚åˆçº¯é™æ€å†…å®¹ã€‚
- ISRï¼šé™æ€ç”Ÿæˆ + å®šæ—¶åˆ·æ–°ï¼Œå…¼é¡¾åŠ¨æ€æ€§ã€‚

**è¯¦ç»†å›ç­”**

- **CSR**ï¼šé€‚åˆåå°ç®¡ç†ç³»ç»Ÿï¼Œç”¨æˆ·ä½“éªŒä¼˜å…ˆï¼ŒSEO ä¸æ•æ„Ÿã€‚
- **SSR**ï¼šæ¯æ¬¡è¯·æ±‚æœåŠ¡ç«¯æ¸²æŸ“ï¼Œé€‚åˆéœ€è¦å®æ—¶æ•°æ®å’Œå¼º SEO çš„é¡µé¢ï¼ˆå¦‚æ–°é—»ï¼‰ã€‚
- **SSG**ï¼šæ„å»ºæ—¶äº§å‡º HTMLï¼Œé€‚åˆåšå®¢ã€æ–‡æ¡£ã€è¥é”€è½åœ°é¡µã€‚
- **ISR**ï¼šé™æ€åŒ–é¡µé¢å¯åœ¨åå°å†ç”Ÿï¼ˆ`revalidate`ï¼‰ï¼Œé€‚åˆç”µå•†ã€å†…å®¹ç«™ç‚¹ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œç”µå•†å•†å“è¯¦æƒ…é¡µé€‰å“ªç§ï¼Ÿâ€ ğŸ‘‰ **ISR**ï¼ˆå¯ç¼“å­˜ï¼Œæ•°æ®æœ‰æ—¶æ•ˆï¼‰ã€‚
- **æˆæœ¬å¯¹æ¯”**ï¼šCSR å‡ ä¹æ— æœåŠ¡ç«¯å‹åŠ›ï¼›SSR æˆæœ¬æœ€é«˜ï¼›SSG æˆæœ¬æœ€ä½ï¼›ISR æŠ˜ä¸­ã€‚

---

### 3. Next.js ä¸­çš„ç›®å½•ç»“æ„ï¼ˆpages/ vs app/ï¼‰ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
`pages/` æ˜¯æ—§ç‰ˆè·¯ç”±ç³»ç»Ÿï¼Œ`app/` æ˜¯æ–° App Routerï¼Œæ”¯æŒ React Server Components å’Œ Server Actionsã€‚

**è¦ç‚¹**

- pages/ï¼šåŸºäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ•°æ®è·å–ä¾èµ– `getServerSideProps`ã€‚
- app/ï¼šå¼•å…¥ RSCã€`layout.tsx`ã€å¹¶è¡Œ/æ‹¦æˆªè·¯ç”±ã€‚
- app/ é»˜è®¤ä½¿ç”¨ React 18 ç‰¹æ€§ã€‚

**è¯¦ç»†å›ç­”**

- **pages/**ï¼šæ•°æ®è·å–é€šè¿‡ `getServerSideProps` / `getStaticProps` / `getStaticPaths`ã€‚
- **app/**ï¼šæ”¯æŒ RSCï¼Œé»˜è®¤ç»„ä»¶åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼›æ”¯æŒ `generateMetadata`ã€`loading.tsx`ã€`error.tsx`ã€Server Actionsã€‚

**æ‰©å±•/å¯¹æ¯”**

- æ–°é¡¹ç›®æ¨è App Routerï¼›æ—§é¡¹ç›®ä»å¤§é‡ä½¿ç”¨ pagesã€‚
- é¢è¯•å¸¸è¿½é—®ï¼šâ€œä¸ºä»€ä¹ˆè¿ç§»åˆ° App Routerï¼Ÿâ€ ğŸ‘‰ æ€§èƒ½æ›´å¥½ï¼Œå‡å°‘å®¢æˆ·ç«¯ JSï¼Œæ•°æ®è·å–ç®€åŒ–ã€‚

---

### 4. ä»€ä¹ˆæ˜¯ App Routerï¼Ÿä¸ºä»€ä¹ˆè¿ç§»ï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
App Router åŸºäº React Server Componentsï¼Œæä¾›æ›´å¼ºçš„æ•°æ®è·å–å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œæ˜¯ Next.js çš„æœªæ¥æ–¹å‘ã€‚

**è¦ç‚¹**

- é»˜è®¤æ”¯æŒ RSCã€‚
- å¤šå±‚ Layout + å¹¶è¡Œ/æ‹¦æˆªè·¯ç”±ã€‚
- æ•°æ®è·å–ç®€åŒ–ï¼Œå†…ç½®ç¼“å­˜ç­–ç•¥ã€‚
- SEO æ›´å‹å¥½ã€‚

**è¯¦ç»†å›ç­”**
App Router æä¾›ï¼š

- **Server Components**ï¼šå‡å°‘å®¢æˆ·ç«¯ JS ä½“ç§¯ã€‚
- **Layout & Nested Routing**ï¼šå¤©ç„¶æ”¯æŒå¤šå±‚å¸ƒå±€ä¸åµŒå¥—ã€‚
- **Server Actions**ï¼šå¯ç›´æ¥åœ¨æœåŠ¡ç«¯å®šä¹‰å¹¶è°ƒç”¨å‡½æ•°ã€‚
- **æµå¼æ¸²æŸ“**ï¼šç»“åˆ Suspense æå‡ç”¨æˆ·ä½“éªŒã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜é—®ï¼šâ€œApp Router æ¯” pages å¥½åœ¨å“ªï¼Ÿâ€ ğŸ‘‰ æ›´å¥½çš„æ€§èƒ½ã€å†…ç½®ç¼“å­˜ã€SSR/SEO æ”¯æŒæ›´å¼ºã€‚
- **å­¦ä¹ æˆæœ¬**ï¼šApp Router è¦ç†Ÿæ‚‰ RSCã€`use client`ã€ç¼“å­˜ç­–ç•¥ã€‚

---

### 5. React Server Components (RSC) çš„ä½œç”¨ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
RSC å…è®¸ç»„ä»¶åœ¨æœåŠ¡ç«¯è¿è¡Œï¼Œå‡å°‘å®¢æˆ·ç«¯ JS ä½“ç§¯ï¼Œæé«˜æ€§èƒ½ã€‚

**è¦ç‚¹**

- é»˜è®¤ç»„ä»¶å³ä¸º RSCã€‚
- å®¢æˆ·ç«¯ç»„ä»¶éœ€æ˜¾å¼ `"use client"`ã€‚
- ä¸èƒ½ä½¿ç”¨æµè§ˆå™¨ APIï¼ˆå¦‚ windowã€documentï¼‰ã€‚

**è¯¦ç»†å›ç­”**

- **RSC åœ¨æœåŠ¡ç«¯æ‰§è¡Œ**ï¼Œè¾“å‡ºåºåˆ—åŒ–çš„ UI æè¿°ï¼Œå®¢æˆ·ç«¯åªéœ€åˆæˆã€‚
- å®¢æˆ·ç«¯ç»„ä»¶è´Ÿè´£äº‹ä»¶ã€çŠ¶æ€å’Œäº¤äº’ï¼ŒæœåŠ¡ç«¯ç»„ä»¶è´Ÿè´£æ•°æ®è·å–å’Œæ‹¼æ¥ UIã€‚
- é™ä½äº†å®¢æˆ·ç«¯ bundle å¤§å°ï¼Œå‡å°‘æ°´åˆå‹åŠ›ã€‚

**æ‰©å±•/å¯¹æ¯”**

- RSC vs SSRï¼šSSR ç”Ÿæˆ HTMLï¼ŒRSC åªç”Ÿæˆè™šæ‹Ÿæ ‘ï¼Œæœ€ç»ˆç”±å®¢æˆ·ç«¯æ‹¼åˆã€‚
- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œä»€ä¹ˆæ—¶å€™å¿…é¡»ç”¨ client componentï¼Ÿâ€ ğŸ‘‰ ä¾èµ– `useState`ã€`useEffect`ã€äº‹ä»¶ç»‘å®šã€æµè§ˆå™¨ API æ—¶ã€‚

---

## äºŒã€æ•°æ®è·å–

### 6. `getServerSideProps` vs `getStaticProps` vs `getStaticPaths` ğŸ”¥

**ä¸€å¥è¯å›ç­”**
`getServerSideProps` æ¯æ¬¡è¯·æ±‚è¿è¡Œï¼Œ`getStaticProps` æ„å»ºæ—¶è¿è¡Œï¼Œ`getStaticPaths` ç”¨äºç”ŸæˆåŠ¨æ€è·¯ç”±ã€‚

**è¦ç‚¹**

- getServerSidePropsï¼šå®æ—¶æ•°æ®ï¼ŒSSRã€‚
- getStaticPropsï¼šæ„å»ºæ—¶æ‰§è¡Œï¼ŒSSGã€‚
- getStaticPathsï¼šé…åˆ SSG åŠ¨æ€è·¯ç”±ã€‚

**è¯¦ç»†å›ç­”**

- `getServerSideProps`ï¼šæ¯æ¬¡è¯·æ±‚è§¦å‘ï¼Œé€‚åˆå®æ—¶æ•°æ®ã€‚
- `getStaticProps`ï¼šæ„å»ºæ—¶æ‰§è¡Œï¼Œè¿”å›çš„ props ä¼šé™æ€å†™å…¥ HTMLã€‚
- `getStaticPaths`ï¼šåœ¨æ„å»ºæ—¶é¢„ç”Ÿæˆæ‰€æœ‰åŠ¨æ€è·¯ç”±é¡µé¢ã€‚

**æ‰©å±•/å¯¹æ¯”**

- å•†å“è¯¦æƒ…é¡µï¼š`getStaticProps + revalidate`ï¼ˆISRï¼‰ã€‚
- é¢è¯•å¸¸é—®ï¼šâ€œä¸ºä»€ä¹ˆä¸ç”¨ getInitialPropsï¼Ÿâ€ ğŸ‘‰ ä¼šé˜»å¡ä¼˜åŒ–ï¼Œå®˜æ–¹å·²å¼ƒç”¨ã€‚

---

### 7. App Router ä¸­çš„æ•°æ®è·å–æ–¹å¼ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
App Router æ¨èåœ¨ Server Components é‡Œç›´æ¥ç”¨ `fetch`ï¼Œç»“åˆ `cache` å’Œ `revalidate` æ§åˆ¶ç¼“å­˜ã€‚

**è¦ç‚¹**

- `fetch` é»˜è®¤æœ‰ç¼“å­˜ã€‚
- `cache: 'no-store'` å¼ºåˆ¶å®æ—¶è¯·æ±‚ã€‚
- `next: { revalidate: 60 }` æ”¯æŒ ISRã€‚

**è¯¦ç»†å›ç­”**

```tsx
export default async function Page() {
  const data = await fetch("https://api.example.com", {
    cache: "no-store",
    next: { revalidate: 60 },
  }).then((res) => res.json());

  return <div>{data.title}</div>;
}
```

- ä¸å†éœ€è¦ `getServerSideProps`ï¼Œç›´æ¥åœ¨ç»„ä»¶é‡Œè·å–æ•°æ®ã€‚
- ç»“åˆ Suspenseï¼Œå¯æµå¼æ¸²æŸ“å†…å®¹ã€‚

**æ‰©å±•/å¯¹æ¯”**

- App Router æ•°æ®è·å–æ›´ç®€æ´ï¼Œä½†è¦ç†è§£ç¼“å­˜ç­–ç•¥ã€‚
- CSR è·å–æ•°æ®ä»ç”¨ SWR/React Queryã€‚

---

### 8. ä»€ä¹ˆæ˜¯ Incremental Static Regeneration (ISR)ï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
ISR å…è®¸é™æ€é¡µé¢åœ¨æ„å»ºåæŒ‰éœ€ã€å®šæœŸé‡æ–°ç”Ÿæˆã€‚

**è¦ç‚¹**

- é™æ€ + åŠ¨æ€ç»“åˆã€‚
- `revalidate` è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚
- SEO å‹å¥½ã€‚

**è¯¦ç»†å›ç­”**

- åˆæ¬¡è¯·æ±‚è¿”å›æ—§é¡µé¢ã€‚
- è§¦å‘åå°å†ç”Ÿæ–°é¡µé¢ã€‚
- ä¸‹æ¬¡è¯·æ±‚æ‹¿åˆ°æ–°ç‰ˆæœ¬ã€‚

**æ‰©å±•/å¯¹æ¯”**

- æ–°é—»ã€ç”µå•†å¸¸ç”¨ ISRï¼Œé¿å…é¢‘ç¹æ„å»ºã€‚
- é¢è¯•å®˜å¸¸é—®ï¼šâ€œISR å’Œ SSG åŒºåˆ«ï¼Ÿâ€ ğŸ‘‰ ISR å¯å®šæœŸåˆ·æ–°ï¼ŒSSG ä¸€æˆä¸å˜ã€‚

---

# ä¸‰ã€è·¯ç”±ä¸å¯¼èˆª

### 9. åŠ¨æ€è·¯ç”±ä¸åµŒå¥—è·¯ç”± ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Next.js åŠ¨æ€è·¯ç”±é€šè¿‡ `[param]`ï¼ŒåµŒå¥—è·¯ç”±é€šè¿‡æ–‡ä»¶å¤¹å±‚çº§å®ç°ã€‚

**è¦ç‚¹**

- **pages/**ï¼š`pages/[id].tsx` å®ç°åŠ¨æ€è·¯ç”±ã€‚
- **app/**ï¼š`app/blog/[slug]/page.tsx`ï¼Œå¤©ç„¶æ”¯æŒåµŒå¥—ã€‚
- æ”¯æŒ catch-allï¼š`[...slug].tsx`ã€‚

**è¯¦ç»†å›ç­”**

- **åŠ¨æ€è·¯ç”±**ï¼šå¦‚ `pages/posts/[id].tsx` â†’ `/posts/1`ã€‚
- **åµŒå¥—è·¯ç”±**ï¼šç›®å½•å±‚çº§å³è·¯ç”±å±‚çº§ï¼Œ`app/dashboard/settings/page.tsx` â†’ `/dashboard/settings`ã€‚
- **catch-all**ï¼š`pages/docs/[...slug].tsx` â†’ `/docs/a/b/c`ã€‚

**æ‰©å±•/å¯¹æ¯”**

- App Router æ›´çµæ´»ï¼Œæ”¯æŒ **å¹³è¡Œè·¯ç”±**ï¼ˆparallel routesï¼‰ã€**æ‹¦æˆªè·¯ç”±**ï¼ˆintercepting routesï¼‰ã€‚
- é¢è¯•å®˜å¸¸é—®ï¼šâ€œå¦‚ä½•ç”Ÿæˆæ‰€æœ‰åŠ¨æ€è·¯ç”±é¡µé¢ï¼Ÿâ€ ğŸ‘‰ `getStaticPaths`ï¼ˆpagesï¼‰æˆ– `generateStaticParams`ï¼ˆappï¼‰ã€‚

---

### 10. `useRouter` Hook ä¸å¯¼èˆª ğŸ”¥

**ä¸€å¥è¯å›ç­”**
`useRouter` æä¾›è·¯ç”±å¯¹è±¡ï¼Œæ”¯æŒç¼–ç¨‹å¼å¯¼èˆªå’Œå‚æ•°è·å–ã€‚

**è¦ç‚¹**

- pages Router ç”¨ `next/router`ã€‚
- `router.push` / `router.replace`ã€‚
- `router.query` è·å–åŠ¨æ€å‚æ•°ã€‚

**è¯¦ç»†å›ç­”**

```tsx
import { useRouter } from "next/router";

const router = useRouter();
console.log(router.query.id); // è·å–åŠ¨æ€è·¯ç”±å‚æ•°
router.push("/home"); // ç¼–ç¨‹å¼è·³è½¬
```

**æ‰©å±•/å¯¹æ¯”**

- App Router ç”¨ `usePathname` å’Œ `useSearchParams` æ›¿ä»£ã€‚
- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œå¦‚ä½•è·å– query å‚æ•°ï¼Ÿâ€ ğŸ‘‰ pages ç”¨ `router.query`ï¼Œapp ç”¨ `useSearchParams()`ã€‚

---

### 11. App Router çš„ `usePathname`ã€`useSearchParams` ğŸ”¥

**ä¸€å¥è¯å›ç­”**
åœ¨ App Router ä¸­ï¼Œ`usePathname` è·å–è·¯å¾„ï¼Œ`useSearchParams` è·å– URL å‚æ•°ã€‚

**è¦ç‚¹**

- `usePathname`ï¼šè¿”å›å­—ç¬¦ä¸²è·¯å¾„ã€‚
- `useSearchParams`ï¼šç±» `URLSearchParams`ã€‚
- æ”¯æŒå“åº”å¼æ›´æ–°ã€‚

**è¯¦ç»†å›ç­”**

```tsx
"use client";
import { usePathname, useSearchParams } from "next/navigation";

const pathname = usePathname(); // "/blog/1"
const searchParams = useSearchParams();
const id = searchParams.get("id");
```

**æ‰©å±•/å¯¹æ¯”**

- æ›¿ä»£äº† `useRouter().query`ã€‚
- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œåœ¨ App Router å¦‚ä½•å®ç°æœç´¢å‚æ•°ç›‘å¬ï¼Ÿâ€ ğŸ‘‰ ç”¨ `useSearchParams`ï¼Œé…åˆ React çŠ¶æ€ç®¡ç†ã€‚

---

### 12. Middleware çš„ä½œç”¨ä¸åº”ç”¨åœºæ™¯ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Middleware åœ¨è¯·æ±‚åˆ°è¾¾é¡µé¢å‰è¿è¡Œï¼Œå¯ç”¨äºé‰´æƒã€é‡å®šå‘ã€å®‰å…¨æ ¡éªŒã€‚

**è¦ç‚¹**

- åŸºäº Edge Runtimeã€‚
- ä¿®æ”¹ Request/Responseã€‚
- åº”ç”¨åœºæ™¯ï¼šç™»å½•æ ¡éªŒã€A/B æµ‹è¯•ã€å›½é™…åŒ–è·¯ç”±ã€‚

**è¯¦ç»†å›ç­”**

```ts
// middleware.ts
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";

export function middleware(req: NextRequest) {
  if (!req.cookies.get("token")) {
    return NextResponse.redirect(new URL("/login", req.url));
  }
}
```

- Middleware åœ¨**è¾¹ç¼˜èŠ‚ç‚¹**è¿è¡Œï¼Œæ€§èƒ½å¥½ï¼Œå»¶è¿Ÿä½ã€‚
- é€‚åˆè½»é‡é€»è¾‘ï¼Œä¸é€‚åˆå¤æ‚è®¡ç®—ã€‚

**æ‰©å±•/å¯¹æ¯”**

- Middleware vs API Routesï¼šMiddleware åœ¨**è¯·æ±‚å‰**è¿è¡Œï¼ŒAPI Routes æ˜¯**å®Œæ•´æœåŠ¡ç«¯æ¥å£**ã€‚
- é¢è¯•å®˜å¸¸é—®ï¼šâ€œæƒé™æ ¡éªŒæ”¾å“ªå±‚åˆé€‚ï¼Ÿâ€ ğŸ‘‰ ç™»å½•æ‹¦æˆªå¯æ”¾ Middlewareï¼Œé«˜çº§æƒé™é€»è¾‘æ”¾ API/åç«¯ã€‚

---

### 13. è·¯ç”±è·³è½¬æ–¹å¼å¯¹æ¯” ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Next.js æ”¯æŒ `<Link>`ã€`useRouter` ç¼–ç¨‹å¼å¯¼èˆªï¼Œä»¥åŠæœåŠ¡ç«¯ `redirect`ã€‚

**è¦ç‚¹**

- `<Link>`ï¼šæ¨èï¼Œå¸¦é¢„å–ã€‚
- `router.push`ï¼šäº‹ä»¶é©±åŠ¨è·³è½¬ã€‚
- `redirect`ï¼šæœåŠ¡ç«¯è·³è½¬ã€‚

**è¯¦ç»†å›ç­”**

- `<Link>` è‡ªåŠ¨åš **prefetch**ï¼Œæé«˜è·³è½¬æ€§èƒ½ã€‚
- `router.push` ç”¨äºæŒ‰é’®ç‚¹å‡»è·³è½¬ã€‚
- App Router çš„ `redirect()` å¯åœ¨æœåŠ¡ç«¯é€»è¾‘ä¸­æ‰§è¡Œè·³è½¬ã€‚

**æ‰©å±•/å¯¹æ¯”**

- CSR åœºæ™¯ï¼šæ¨è `<Link>`ã€‚
- SSR åœºæ™¯ï¼šæ¨è `redirect`ã€‚
- é¢è¯•å®˜å¸¸é—®ï¼šâ€œSSR é‰´æƒå¤±è´¥å¦‚ä½•è·³è½¬ï¼Ÿâ€ ğŸ‘‰ `redirect('/login')`ã€‚

---

# å››ã€æ ·å¼ä¸èµ„æº

### 14. Next.js æ”¯æŒçš„æ ·å¼æ–¹å¼ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Next.js æ”¯æŒ CSS Modulesã€å…¨å±€ CSSã€CSS-in-JSã€Tailwind ç­‰å¤šç§æ–¹æ¡ˆã€‚

**è¦ç‚¹**

- **å…¨å±€ CSS**ï¼š`app/globals.css` æˆ– `pages/_app.tsx` å¼•å…¥ã€‚
- **CSS Modules**ï¼šé»˜è®¤æ”¯æŒï¼Œé¿å…å‘½åå†²çªã€‚
- **CSS-in-JS**ï¼šstyled-components / emotion éœ€é…ç½® babel æ’ä»¶ã€‚
- **Tailwind CSS**ï¼šå®˜æ–¹æ–‡æ¡£æ¨èï¼Œé€‚åˆä¸­å¤§å‹é¡¹ç›®ã€‚

**è¯¦ç»†å›ç­”**

- CSS Modules è‡ªåŠ¨ç”Ÿæˆå“ˆå¸Œ classNameï¼Œæœ¬åœ°ä½œç”¨åŸŸéš”ç¦»ã€‚
- å…¨å±€ CSS é€‚åˆåŸºç¡€æ ·å¼ã€resetã€variablesã€‚
- styled-components éœ€è¦åœ¨ `next.config.js` é…ç½® `compiler.styledComponents = true`ã€‚
- Tailwind åœ¨ Next.js é¡¹ç›®ä¸­å¯é€šè¿‡å®˜æ–¹æ’ä»¶å¿«é€Ÿæ¥å…¥ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œä½ ä»¬å›¢é˜Ÿç”¨ä»€ä¹ˆæ ·å¼æ–¹æ¡ˆï¼Ÿâ€ ğŸ‘‰ å¤§å‚å¸¸ç­”ï¼š**Tailwind + CSS Modules**ï¼ˆé€šç”¨ï¼‰ã€**styled-components**ï¼ˆé«˜åº¦å®šåˆ¶ï¼‰ã€‚
- å¯¹æ¯”ï¼šCSS Modules â†’ æœ€åŸç”Ÿï¼ŒTailwind â†’ æ•ˆç‡é«˜ï¼ŒCSS-in-JS â†’ çµæ´»ä½†å¯èƒ½å½±å“æ€§èƒ½ã€‚

---

### 15. `next/image` ä¸ `next/font` çš„ä½œç”¨ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
`next/image` ä¼˜åŒ–å›¾ç‰‡åŠ è½½ï¼Œ`next/font` ä¼˜åŒ–å­—ä½“åŠ è½½ã€‚

**è¦ç‚¹**

- `next/image`ï¼šæ‡’åŠ è½½ã€è‡ªåŠ¨å‹ç¼©ã€å“åº”å¼ã€‚
- `next/font`ï¼šGoogle Fonts æœ¬åœ°åŒ–ã€å¯å˜å­—ä½“æ”¯æŒã€‚
- å‡å‡å°‘ CLSã€æé«˜æ€§èƒ½è¯„åˆ†ã€‚

**è¯¦ç»†å›ç­”**

```tsx
import Image from "next/image";

<Image src="/logo.png" width={200} height={200} alt="logo" />;

// å­—ä½“ä¼˜åŒ–
import { Inter } from "next/font/google";
const inter = Inter({ subsets: ["latin"] });
```

- `next/image` é»˜è®¤å¯ç”¨æ‡’åŠ è½½å’Œè‡ªåŠ¨ä¼˜åŒ–ï¼Œæ”¯æŒ blur å ä½ç¬¦ã€‚
- `next/font` è‡ªåŠ¨ç”Ÿæˆ font-faceï¼Œé¿å… FOUT/FOITã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œä¸ºä»€ä¹ˆä¸ç”¨ <img>ï¼Ÿâ€ ğŸ‘‰ `next/image` æä¾›ä¼˜åŒ–ç®¡é“ + CDN åŠ é€Ÿã€‚
- å­—ä½“ä¼˜åŒ–æ¯”ç›´æ¥å¼•ç¬¬ä¸‰æ–¹ link æ›´å®‰å…¨ï¼ˆé¿å…è¢«åŠ«æŒï¼‰ã€‚

---

### 16. é™æ€èµ„æºçš„å­˜æ”¾ä¸å¼•ç”¨ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Next.js é™æ€èµ„æºæ”¾åœ¨ `public/`ï¼Œé€šè¿‡ `/è·¯å¾„` ç›´æ¥è®¿é—®ã€‚

**è¦ç‚¹**

- `public/logo.png` â†’ `/logo.png`ã€‚
- æ— éœ€ importï¼Œç›´æ¥å¼•ç”¨ã€‚
- ä¸ä¼šè¢«æ‰“åŒ…è¿› JSã€‚

**è¯¦ç»†å›ç­”**

- é™æ€èµ„æºé€‚åˆ faviconã€robots.txtã€å›¾ç‰‡ã€è§†é¢‘ç­‰ã€‚
- ä¼˜ç‚¹ï¼šCDN å¯ç›´æ¥ç¼“å­˜ï¼Œå‡å°‘ JS bundleã€‚

**æ‰©å±•/å¯¹æ¯”**

- é™æ€èµ„æº vs `import`ï¼šé™æ€èµ„æºä¸ä¼šå¢åŠ  JS ä½“ç§¯ï¼Œimport ä¼šè¢«æ‰“åŒ…ã€‚
- é¢è¯•å®˜å¸¸é—®ï¼šâ€œpublic ä¸ src/assets åŒºåˆ«ï¼Ÿâ€ ğŸ‘‰ public ä¸ä¼šè¿›æ‰“åŒ…ï¼Œsrc/assets ä¼šã€‚

---

# äº”ã€API ä¸æœåŠ¡ç«¯èƒ½åŠ›

### 17. Next.js ä¸­çš„ API Routes ğŸ”¥

**ä¸€å¥è¯å›ç­”**
API Routes åœ¨ `pages/api/*` ä¸‹ï¼Œæä¾›å†…ç½®åç«¯æ¥å£èƒ½åŠ›ã€‚

**è¦ç‚¹**

- è¿è¡Œåœ¨ Node.js ç¯å¢ƒã€‚
- æ”¯æŒ RESTfulï¼ˆGET/POST ç­‰ï¼‰ã€‚
- å¸¸ç”¨äº BFFã€å°å‹æ¥å£ã€‚

**è¯¦ç»†å›ç­”**

```ts
// pages/api/hello.ts
export default function handler(req, res) {
  res.status(200).json({ msg: "Hello API" });
}
```

- é€‚åˆå¤„ç†ç®€å•è¯·æ±‚ï¼ˆè¡¨å•æäº¤ã€ä»£ç†ã€è®¤è¯ï¼‰ã€‚
- ä¸é€‚åˆé«˜è´Ÿè½½ä¸šåŠ¡ï¼ˆéœ€ç‹¬ç«‹åç«¯ï¼‰ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œAPI Routes èƒ½æ›¿ä»£åç«¯å—ï¼Ÿâ€ ğŸ‘‰ å°å‹é¡¹ç›®å¯ï¼Œå¤æ‚ä¸šåŠ¡æœ€å¥½ BFF/ç‹¬ç«‹æœåŠ¡ã€‚

---

### 18. App Router ä¸­çš„ Route Handlers ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Route Handlers åœ¨ `app/api/*/route.ts`ï¼Œæ˜¯ App Router çš„ API è·¯ç”±ã€‚

**è¦ç‚¹**

- åŸºäº Web æ ‡å‡† Request/Response APIã€‚
- æ”¯æŒ GET/POST/PUT/DELETEã€‚
- å¯è¿è¡Œåœ¨ Edge Runtimeã€‚

**è¯¦ç»†å›ç­”**

```ts
// app/api/hello/route.ts
import { NextResponse } from "next/server";

export async function GET(req: Request) {
  return NextResponse.json({ msg: "hello" });
}
```

- æ›´æ¥è¿‘ Web Fetch æ ‡å‡†ï¼Œç»Ÿä¸€å¼€å‘ä½“éªŒã€‚
- æ”¯æŒ edge functions éƒ¨ç½²ï¼Œæ›´ä½å»¶è¿Ÿã€‚

**æ‰©å±•/å¯¹æ¯”**

- pages/api vs app/apiï¼špages æ˜¯ Node é£æ ¼ï¼Œapp æ˜¯ Web æ ‡å‡†ã€‚
- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œå¦‚ä½•å†³å®šè¿è¡Œç¯å¢ƒï¼Ÿâ€ ğŸ‘‰ `export const runtime = "edge"` / "nodejs"ã€‚

---

### 19. Middleware ä¸ Edge Functions çš„åŒºåˆ« ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Middleware åœ¨è¯·æ±‚å‰æ‹¦æˆªï¼ŒEdge Functions åœ¨è¾¹ç¼˜è¿è¡Œå®Œæ•´å‡½æ•°é€»è¾‘ã€‚

**è¦ç‚¹**

- Middlewareï¼šè½»é‡æ‹¦æˆªï¼Œä¿®æ”¹ req/resã€‚
- Edge Functionsï¼šå¯ä½œä¸ºå®Œæ•´ API æ¥å£ã€‚
- éƒ½è¿è¡Œåœ¨ Edge Runtimeï¼ˆV8 æ²™ç®±ï¼‰ã€‚

**è¯¦ç»†å›ç­”**

- Middlewareï¼šé€‚åˆé‰´æƒã€é‡å®šå‘ã€æ—¥å¿—ã€å›½é™…åŒ–ã€‚
- Edge Functionsï¼šé€‚åˆå»¶è¿Ÿæ•æ„Ÿçš„ APIï¼ˆA/B æµ‹è¯•ã€æ¨èç³»ç»Ÿï¼‰ã€‚

**æ‰©å±•/å¯¹æ¯”**

- Middleware vs API Routesï¼šMiddleware æ— è¿”å› UI/API é€»è¾‘ï¼Œä»…æ‹¦æˆªã€‚
- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œä»€ä¹ˆæ—¶å€™ç”¨ Edge Functionï¼Ÿâ€ ğŸ‘‰ åŠ¨æ€å†…å®¹åœ¨å…¨çƒåˆ†å‘æ—¶ã€‚

---

### 20. Next.js ä¸­çš„é‰´æƒå®ç° ğŸ”¥

**ä¸€å¥è¯å›ç­”**
å¸¸è§æ–¹æ¡ˆï¼šJWTã€æœ¬åœ° sessionã€NextAuth.jsï¼Œç»“åˆ Middleware åšè·¯ç”±ä¿æŠ¤ã€‚

**è¦ç‚¹**

- JWTï¼šæ”¾ HttpOnly Cookieã€‚
- Middlewareï¼šæ‹¦æˆªæœªæˆæƒè¯·æ±‚ã€‚
- NextAuth.jsï¼šå®˜æ–¹æ¨èæ’ä»¶ã€‚

**è¯¦ç»†å›ç­”**

```ts
// middleware.ts
import { NextResponse } from "next/server";

export function middleware(req) {
  const token = req.cookies.get("token");
  if (!token) return NextResponse.redirect(new URL("/login", req.url));
}
```

- JWT é€‚åˆå‰åç«¯åˆ†ç¦»ã€‚
- NextAuth.js é›†æˆ OAuthã€Credentialsã€Email ç™»å½•ã€‚
- Session å­˜åœ¨ Redis/DBï¼Œé…åˆ `next-auth`ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œToken å­˜å“ªé‡Œæ›´å®‰å…¨ï¼Ÿâ€ ğŸ‘‰ HttpOnly Cookieã€‚
- localStorage å­˜ token æ˜“è¢« XSS çªƒå–ã€‚

---

# å…­ã€æ€§èƒ½ä¸ä¼˜åŒ–

### 21. Next.js å†…ç½®æ€§èƒ½ä¼˜åŒ– ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Next.js è‡ªåŠ¨åšä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ã€å›¾ç‰‡/å­—ä½“ä¼˜åŒ–ã€è·¯ç”±é¢„å–ï¼Œæé«˜ Lighthouse/Web Vitals å¾—åˆ†ã€‚

**è¦ç‚¹**

- è‡ªåŠ¨ **ä»£ç åˆ†å‰²**ï¼šæ¯ä¸ªé¡µé¢ç‹¬ç«‹ chunkã€‚
- å›¾ç‰‡ä¼˜åŒ–ï¼š`next/image`ã€‚
- å­—ä½“ä¼˜åŒ–ï¼š`next/font`ã€‚
- é¢„å–ï¼š`<Link>` é»˜è®¤é¢„å–ä¸‹ä¸€é¡µã€‚

**è¯¦ç»†å›ç­”**

- **ä»£ç åˆ†å‰²**ï¼šé¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªåº”ç”¨ã€‚
- **å›¾ç‰‡ä¼˜åŒ–**ï¼šè‡ªå¸¦æ‡’åŠ è½½ã€å“åº”å¼ã€WebP å‹ç¼©ã€‚
- **å­—ä½“ä¼˜åŒ–**ï¼šå†…ç½® Google Fonts æœ¬åœ°åŒ–ã€‚
- **é¢„å–**ï¼šåœ¨è§†å£ä¸­ `<Link>` å…ƒç´ ä¼šè‡ªåŠ¨é¢„å–å¯¹åº”é¡µé¢ bundleã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œä¸ºä»€ä¹ˆ Next.js æ€§èƒ½æ¯” CRA å¥½ï¼Ÿâ€ ğŸ‘‰ CRA é»˜è®¤æ²¡æœ‰ SSR/ISRã€ä»£ç åˆ†å‰²ä¸å¤Ÿç²¾ç»†ã€æ— å›¾ç‰‡/å­—ä½“ä¼˜åŒ–ã€‚
- Next.js åœ¨**æ— é…ç½®**æƒ…å†µä¸‹å³å¯è¾¾åˆ°é«˜æ€§èƒ½è¯„åˆ†ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚

---

### 22. å¦‚ä½•æå‡ Next.js é¦–å±æ€§èƒ½ï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
å‡å°‘é˜»å¡èµ„æºã€ä¼˜åŒ–æ¸²æŸ“é“¾è·¯ï¼Œåˆ©ç”¨ ISRã€æ‡’åŠ è½½å’Œ Critical CSS æå‡é¦–å±ä½“éªŒã€‚

**è¦ç‚¹**

- æ‡’åŠ è½½ï¼šç»„ä»¶/å›¾ç‰‡/è§†é¢‘ã€‚
- Critical CSSï¼šåªåŠ è½½é¦–å±éœ€è¦çš„æ ·å¼ã€‚
- ISRï¼šç¼“å­˜é¡µé¢ï¼Œå‡å°‘æœåŠ¡ç«¯å‹åŠ›ã€‚
- èµ„æºæ‹†åˆ†ï¼šåŠ¨æ€ importã€‚

**è¯¦ç»†å›ç­”**

- **å›¾ç‰‡æ‡’åŠ è½½**ï¼šéé¦–å±å›¾ç‰‡ä½¿ç”¨ `loading="lazy"`ã€‚
- **åŠ¨æ€ import**ï¼š`import dynamic(() => import('../HeavyComp'))`ã€‚
- **Critical CSS**ï¼šNext.js è‡ªåŠ¨æŠ½å–ï¼Œé¿å… render-blockingã€‚
- **æµå¼æ¸²æŸ“ï¼ˆStreaming SSRï¼‰**ï¼šç”¨æˆ·å…ˆçœ‹åˆ° skeletonï¼Œå†æ¸è¿›æ›´æ–°å†…å®¹ã€‚

**æ‰©å±•/å¯¹æ¯”**

- æµ‹é‡å·¥å…·ï¼š**Lighthouseã€Web Vitalsã€Next.js è‡ªå¸¦åˆ†æå™¨**ã€‚
- é¢è¯•å®˜å¸¸é—®ï¼šâ€œå¦‚ä½•ä¼˜åŒ– LCP/CLS/FIDï¼Ÿâ€ ğŸ‘‰ é€šè¿‡å›¾ç‰‡ä¼˜åŒ–ã€å‡å°‘ JSã€å­—ä½“ä¼˜åŒ–ã€‚

---

### 23. Next.js ä¸­çš„ç¼“å­˜æœºåˆ¶ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Next.js åŸºäº RSC + fetch å†…ç½®ç¼“å­˜ï¼Œå¯è®¾ç½® `cache` å’Œ `revalidate` ç²¾ç»†åŒ–æ§åˆ¶ã€‚

**è¦ç‚¹**

- `cache: 'force-cache'`ï¼ˆé»˜è®¤ï¼‰ã€‚
- `cache: 'no-store'`ï¼ˆç¦ç”¨ç¼“å­˜ï¼‰ã€‚
- `next: { revalidate: X }`ï¼ˆISRï¼‰ã€‚

**è¯¦ç»†å›ç­”**

```ts
const data = await fetch("https://api.example.com", {
  cache: "no-store", // æˆ– "force-cache"
  next: { revalidate: 60 },
});
```

- **SSR é¡µé¢**ï¼š`no-store`ï¼Œä¿è¯å®æ—¶ã€‚
- **ISR é¡µé¢**ï¼š`revalidate`ï¼Œå®šæ—¶æ›´æ–°ã€‚
- **SSG é¡µé¢**ï¼š`force-cache`ï¼Œæ„å»ºæ—¶é™æ€ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œæ€ä¹ˆé¿å…ç¼“å­˜è¿‡æœŸæ—¶ç”¨æˆ·ç­‰ç™½å±ï¼Ÿâ€ ğŸ‘‰ ISR æ—§é¡µé¢ç»§ç»­å¯ç”¨ï¼Œæ–°é¡µé¢åå°ç”Ÿæˆã€‚
- App Router æ¯” pages Router æ›´ç»Ÿä¸€ï¼Œfetch å°±èƒ½æå®šï¼Œä¸ç”¨å†™ä¸€å † GSP/GSSPã€‚

---

# ä¸ƒã€SEO ä¼˜åŒ–

### 24. Next.js å¦‚ä½•æå‡ SEOï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
åˆ©ç”¨ SSR/SSG/ISR è¾“å‡º HTMLï¼Œç»“åˆ `generateMetadata`ã€sitemapã€robots.txt æå‡å¯çˆ¬å–æ€§ã€‚

**è¦ç‚¹**

- SSR/SSGï¼šHTML å¯ç›´æ¥è¢«çˆ¬è™«è¯»å–ã€‚
- `generateMetadata`ï¼šApp Router æ¨èã€‚
- sitemap.xmlã€robots.txtã€‚
- Open Graphï¼ˆOGï¼‰ä¿¡æ¯ï¼šç¤¾äº¤åˆ†äº«ä¼˜åŒ–ã€‚

**è¯¦ç»†å›ç­”**

```ts
// app/blog/[slug]/page.tsx
export async function generateMetadata({ params }) {
  return {
    title: `Blog ${params.slug}`,
    description: "SEO ä¼˜åŒ–ç¤ºä¾‹",
    openGraph: { title: "Blog OG", images: ["/og.png"] },
  };
}
```

- **App Router**ï¼šæ¨èç”¨ `generateMetadata`ã€‚
- **Pages Router**ï¼šç”¨ `next/head`ã€‚
- **é™„åŠ ä¼˜åŒ–**ï¼šcanonical é“¾æ¥ã€é˜²æ­¢é‡å¤å†…å®¹ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œNext.js ä¸ºä»€ä¹ˆæ¯”çº¯ React SEO å¥½ï¼Ÿâ€ ğŸ‘‰ React é»˜è®¤ CSRï¼ˆHTML ç©ºå£³ï¼‰ï¼ŒNext.js SSR/SSG/ISR è¾“å‡ºå®Œæ•´ HTMLã€‚
- Next.js å†…ç½® sitemap/robots ç”Ÿæˆæ’ä»¶ï¼ŒCRA æ²¡æœ‰ã€‚

---

### 25. å¦‚ä½•å¤„ç†å¤šè¯­è¨€/å›½é™…åŒ– (i18n) SEOï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
é€šè¿‡ Next.js i18n é…ç½® + `hreflang` æ ‡ç­¾ï¼Œå®ç°å¤šè¯­è¨€é¡µé¢çš„ SEO ä¼˜åŒ–ã€‚

**è¦ç‚¹**

- `next.config.js` â†’ `i18n.locales`ã€‚
- è‡ªåŠ¨ç”Ÿæˆå¤šè¯­è¨€è·¯ç”±ã€‚
- `hreflang` æ ‡ç­¾å¸®åŠ©æœç´¢å¼•æ“è¯†åˆ«è¯­è¨€ç‰ˆæœ¬ã€‚

**è¯¦ç»†å›ç­”**

- é…ç½® `next.config.js`ï¼š

```js
i18n: {
  locales: ["en", "zh", "fr"],
  defaultLocale: "en",
}
```

- é¡µé¢è·¯ç”±è‡ªåŠ¨æ”¯æŒ `/zh/blog`ã€`/fr/blog`ã€‚
- SEO éœ€è¦åœ¨ `<head>` åŠ ï¼š

```html
<link rel="alternate" href="https://example.com/zh" hreflang="zh" />
<link rel="alternate" href="https://example.com/en" hreflang="en" />
```

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œi18n æ€ä¹ˆå…¼é¡¾ SEOï¼Ÿâ€ ğŸ‘‰ é…ç½® hreflangã€ç”Ÿæˆ sitemap å¤šè¯­è¨€ç‰ˆæœ¬ã€‚

---

# å…«ã€å®‰å…¨

### 26. Next.js å¦‚ä½•é˜²å¾¡ XSSï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
åˆ©ç”¨ React é»˜è®¤è½¬ä¹‰ + ç¦ç”¨å±é™© API + CSP + DOMPurify é˜²å¾¡ XSSã€‚

**è¦ç‚¹**

- JSX é»˜è®¤è½¬ä¹‰ã€‚
- é¿å… `dangerouslySetInnerHTML`ã€‚
- CSP é™åˆ¶è„šæœ¬æ¥æºã€‚
- DOMPurify æ¸…æ´—å¯Œæ–‡æœ¬ã€‚

**è¯¦ç»†å›ç­”**

- React é»˜è®¤æŠŠ `<script>` è½¬ä¹‰æˆæ–‡æœ¬ã€‚
- å¿…é¡»æ¸²æŸ“å¯Œæ–‡æœ¬æ—¶ï¼š

```tsx
import DOMPurify from "dompurify";

<div dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(content) }} />;
```

- é…åˆ CSPï¼Œé˜²æ­¢å¤–éƒ¨è„šæœ¬æ‰§è¡Œã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œä¸ºä»€ä¹ˆ token ä¸æ”¾ localStorageï¼Ÿâ€ ğŸ‘‰ localStorage æ˜“è¢« XSS çªƒå–ï¼Œåº”æ”¾ HttpOnly Cookieã€‚
- Next.js æ²¡æœ‰é¢å¤–é˜²æŠ¤ï¼Œä½†é»˜è®¤ RSC é™ä½å®¢æˆ·ç«¯æš´éœ²é¢ã€‚

---

### 27. Next.js å¦‚ä½•é˜²å¾¡ CSRFï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
é€šè¿‡ SameSite Cookieã€CSRF Tokenã€äºŒæ¬¡ç¡®è®¤æœºåˆ¶ã€‚

**è¦ç‚¹**

- Cookieï¼š`SameSite=Lax` æˆ– `Strict`ã€‚
- CSRF Tokenï¼šè¡¨å•/è¯·æ±‚æºå¸¦ã€‚
- é«˜å±æ“ä½œåŠ äºŒæ¬¡ç¡®è®¤ã€‚

**è¯¦ç»†å›ç­”**

- æœåŠ¡ç«¯ç”Ÿæˆ CSRF Tokenï¼Œå‰ç«¯è¡¨å•/è¯·æ±‚æäº¤æ—¶é™„å¸¦ã€‚
- Cookie è®¾ç½®ï¼š

```http
Set-Cookie: session=abc; HttpOnly; Secure; SameSite=Lax
```

- ç™»å½•æ€è·¨ç«™è¯·æ±‚ä¸è‡ªåŠ¨å¸¦ Cookieã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¯èƒ½é—®ï¼šâ€œSameSite=Strict ä¼šæœ‰å•¥é—®é¢˜ï¼Ÿâ€ ğŸ‘‰ ç”¨æˆ·ä»å¤–éƒ¨ç«™ç‚¹è·³è½¬å›æ¥æ—¶å¯èƒ½ä¸¢ç™»å½•æ€ã€‚
- æœ€ä½³å®è·µï¼šSameSite=Lax + CSRF Tokenã€‚

---

### 28. ç‚¹å‡»åŠ«æŒé˜²å¾¡ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
é€šè¿‡ `X-Frame-Options` æˆ– CSP çš„ `frame-ancestors` ç¦æ­¢é¡µé¢è¢« iframe åµŒå…¥ã€‚

**è¦ç‚¹**

- `X-Frame-Options: DENY`ã€‚
- CSPï¼š`frame-ancestors 'self'`ã€‚
- å‰ç«¯å¯æ£€æµ‹ `window.top !== window.self`ã€‚

**è¯¦ç»†å›ç­”**

- **æœåŠ¡å™¨å¤´**ï¼š

```http
Content-Security-Policy: frame-ancestors 'self'
```

- **å‰ç«¯æ£€æµ‹**ï¼š

```ts
if (window.top !== window.self) {
  document.body.innerHTML = "Blocked in iframe";
}
```

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œå“ªäº›ç½‘ç«™ä»å…è®¸è¢« iframe åµŒå…¥ï¼Ÿâ€ ğŸ‘‰ ç¬¬ä¸‰æ–¹æ”¯ä»˜ã€åµŒå…¥å¼æ’ä»¶ï¼ˆéœ€ç‰¹å®šç™½åå•ï¼‰ã€‚

---

# ä¹ã€å·¥ç¨‹åŒ– & æ„å»ºä¼˜åŒ–

### 29. Next.js çš„æ„å»ºä¸éƒ¨ç½²æµç¨‹ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Next.js æ„å»ºäº§ç‰©åŒ…å« `.next/` é™æ€èµ„æºå’Œ serverless å‡½æ•°ï¼Œå¯éƒ¨ç½²åˆ° Vercelã€Node Serverã€Edge Functionsã€‚

**è¦ç‚¹**

- æ„å»ºå‘½ä»¤ï¼š`next build`ã€‚
- äº§ç‰©ï¼šé™æ€æ–‡ä»¶ + serverless/edge ä»£ç ã€‚
- éƒ¨ç½²æ–¹å¼ï¼šVercelï¼ˆé»˜è®¤ï¼‰ã€Node.jsã€è‡ªæ‰˜ç®¡ã€Dockerã€é™æ€å¯¼å‡ºã€‚

**è¯¦ç»†å›ç­”**

- `next build` â†’ ç”Ÿæˆ `.next/` ç›®å½•ï¼ŒåŒ…å« `server/`ã€`static/`ã€`chunks/`ã€‚
- ç”Ÿäº§å¯åŠ¨ï¼š`next start`ã€‚
- éƒ¨ç½²æ–¹å¼ï¼š

  - **Vercel**ï¼šä¸€é”®éƒ¨ç½²ï¼Œè‡ªåŠ¨ ISRã€‚
  - **Node.js Server**ï¼šé€šè¿‡ `next start` è‡ªè¡Œéƒ¨ç½²ã€‚
  - **é™æ€å¯¼å‡º**ï¼š`next export`ï¼Œä»…æ”¯æŒçº¯ SSGã€‚
  - **Docker**ï¼šå¸¸è§äºä¼ä¸š CI/CDã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œISR é™æ€å¯¼å‡ºèƒ½ç”¨å—ï¼Ÿâ€ ğŸ‘‰ ä¸èƒ½ï¼Œå¿…é¡»ç”¨æ”¯æŒæœåŠ¡ç«¯çš„éƒ¨ç½²ç¯å¢ƒã€‚
- éƒ¨ç½²æ—¶è¦å…³æ³¨ CDN ç¼“å­˜ç­–ç•¥ï¼Œé¿å… ISR æ— æ•ˆã€‚

---

### 30. CI/CD å¦‚ä½•é›†æˆ Next.jsï¼Ÿ ğŸ”¥

**ä¸€å¥è¯å›ç­”**
CI/CD é€šè¿‡ GitHub Actions/GitLab CI è‡ªåŠ¨åŒ–æ‰§è¡Œæ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ã€‚

**è¦ç‚¹**

- Lint + Test â†’ Build â†’ Deployã€‚
- å¸¸ç”¨å‘½ä»¤ï¼š`npm run lint && npm run test && npm run build`ã€‚
- éƒ¨ç½²åˆ° Vercel/è‡ªå»ºæœåŠ¡å™¨ã€‚

**è¯¦ç»†å›ç­”**

```yaml
# GitHub Actions ç¤ºä¾‹
name: Next.js CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm ci
      - run: npm run lint
      - run: npm run build
      - run: npm run test
```

- ä¼ä¸šå†…å¯ç»“åˆ **Jenkins** æˆ– **GitLab CI**ï¼Œå†é…åˆ Docker é•œåƒå‘å¸ƒã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œä½ ä»¬å›¢é˜Ÿæ€ä¹ˆä¿è¯ä¸Šçº¿è´¨é‡ï¼Ÿâ€ ğŸ‘‰ CI è·‘æµ‹è¯•ã€lintï¼ŒCD è‡ªåŠ¨å›æ»šã€‚
- Vercel é›†æˆ CI/CD æœ€ç®€å•ï¼ŒGit push å³è§¦å‘æ„å»ºã€‚

---

### 31. Next.js Monorepo ç®¡ç† ğŸ”¥

**ä¸€å¥è¯å›ç­”**
Monorepo ç®¡ç†å¤šä¸ªåº”ç”¨/åŒ…ï¼Œå¸¸ç”¨ pnpm workspaceã€Turborepoã€Nxã€‚

**è¦ç‚¹**

- **pnpm workspace**ï¼šè½»é‡ï¼Œä¾èµ–å»é‡ã€‚
- **Turborepo**ï¼šç¼“å­˜ + å¹¶è¡Œæ„å»ºã€‚
- **Nx**ï¼šæ’ä»¶ä¸°å¯Œï¼Œé€‚åˆå¤§å‹ä¼ä¸šã€‚

**è¯¦ç»†å›ç­”**

- Monorepo ä¼˜åŠ¿ï¼šå…±äº«ç»„ä»¶ã€ä¾èµ–ä¸€è‡´ã€ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†ã€‚
- Next.js + pnpm workspaceï¼šå¤šä¸ªåº”ç”¨å…±ç”¨ä¾èµ–ï¼Œ`pnpm install` èŠ‚çœç£ç›˜ã€‚
- Turborepoï¼šç¼“å­˜æ„å»ºç»“æœï¼Œæé«˜ CI é€Ÿåº¦ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œä¸ºä»€ä¹ˆé€‰ pnpmï¼Ÿâ€ ğŸ‘‰ ç¡¬é“¾æ¥èŠ‚çœç£ç›˜ + Monorepo æ”¯æŒå¼ºã€‚
- å¤§å‚ï¼ˆGoogle/Metaï¼‰å¸¸ç”¨ Monorepoï¼Œé…åˆè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚

---

### 32. åŒ…ç®¡ç†å™¨å¯¹æ¯”ï¼šnpm / yarn / pnpm ğŸ”¥

**ä¸€å¥è¯å›ç­”**
npm å®˜æ–¹ï¼Œyarn å¼ºè°ƒä¸€è‡´æ€§ï¼Œpnpm ç£ç›˜å ç”¨æœ€å°ï¼ŒMonorepo æœ€ä¼˜ã€‚

**è¦ç‚¹**

- **npm**ï¼šæœ€é€šç”¨ï¼Œv5+ æœ‰ lock æ–‡ä»¶ã€‚
- **yarn**ï¼šæ›´å¿«ï¼Œworkspaces å‹å¥½ã€‚
- **pnpm**ï¼šå†…å®¹å¯»å€ + ç¡¬é“¾æ¥ï¼ŒèŠ‚çœç£ç›˜ã€‚

**è¯¦ç»†å›ç­”**

- yarn v1 â†’ æ›¿ä»£ npm çš„æ€§èƒ½ç“¶é¢ˆï¼›yarn v2 (berry) å¼•å…¥ Plugâ€™nâ€™Playã€‚
- pnpm é€šè¿‡å…¨å±€å†…å®¹å¯»å€ï¼Œå¤šä¸ªé¡¹ç›®å¯å…±äº«ä¾èµ–ï¼Œå‡å°‘é‡å¤ä¸‹è½½ã€‚
- Monorepo åœºæ™¯ï¼Œpnpm workspace æœ€è½»é‡ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œpnpm å’Œ yarn workspaces å“ªä¸ªå¥½ï¼Ÿâ€ ğŸ‘‰ pnpm ç£ç›˜æ•ˆç‡æ›´é«˜ã€‚
- CI/CD åœºæ™¯æ¨è `npm ci` / `pnpm install --frozen-lockfile` ä¿è¯ä¸€è‡´æ€§ã€‚

---

### 33. Node ç‰ˆæœ¬ç®¡ç†ï¼šnvm ğŸ”¥

**ä¸€å¥è¯å›ç­”**
nvm ç®¡ç†å¤šä¸ª Node.js ç‰ˆæœ¬ï¼Œä¿è¯å›¢é˜Ÿ/CI ç¯å¢ƒä¸€è‡´ã€‚

**è¦ç‚¹**

- `nvm use` åˆ‡æ¢ç‰ˆæœ¬ã€‚
- `.nvmrc` å›ºå®šé¡¹ç›® Node ç‰ˆæœ¬ã€‚
- é¿å…ç¯å¢ƒå·®å¼‚å¯¼è‡´æ„å»ºå¤±è´¥ã€‚

**è¯¦ç»†å›ç­”**

- è€é¡¹ç›®å¯èƒ½ç”¨ Node 14ï¼Œæ–°é¡¹ç›®ç”¨ Node 18ã€‚
- å›¢é˜Ÿæˆå‘˜åªéœ€ `nvm use` å³å¯å¯¹é½ç‰ˆæœ¬ã€‚
- CI/CD æµæ°´çº¿å¯é…ç½® Node ç‰ˆæœ¬ã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œå¦‚ä½•é¿å…ç¯å¢ƒå·®å¼‚ï¼Ÿâ€ ğŸ‘‰ `.nvmrc` + CI é…ç½® Node ç‰ˆæœ¬ã€‚
- Windows ç”¨ `nvm-windows` æ›¿ä»£ã€‚

---

### 34. Git Flow / GitHub Flow / Trunk-based ğŸ”¥

**ä¸€å¥è¯å›ç­”**
ä¸‰ç§åˆ†æ”¯æ¨¡å‹åˆ†åˆ«é€‚åˆä¸åŒå›¢é˜Ÿè§„æ¨¡ï¼šGit Flowï¼ˆå®Œæ•´ï¼‰ã€GitHub Flowï¼ˆè½»é‡ï¼‰ã€Trunk-basedï¼ˆç°ä»£ DevOpsï¼‰ã€‚

**è¦ç‚¹**

- Git Flowï¼šmasterã€developã€featureã€releaseã€hotfixã€‚
- GitHub Flowï¼šmain + feature + PRã€‚
- Trunk-basedï¼šæ‰€æœ‰äººç›´æ¥ mainï¼Œæ¯å¤©å¤šæ¬¡é›†æˆã€‚

**è¯¦ç»†å›ç­”**

- **Git Flow**ï¼šåˆ†æ”¯æ¸…æ™°ï¼Œé€‚åˆé•¿å‘¨æœŸé¡¹ç›®ã€‚
- **GitHub Flow**ï¼šç®€æ´ï¼Œé€‚åˆæ•æ·å¼€å‘ã€‚
- **Trunk-based**ï¼šå¤§å‚å¸¸ç”¨ï¼Œç»“åˆ Feature Flagã€‚

**æ‰©å±•/å¯¹æ¯”**

- é¢è¯•å®˜å¸¸é—®ï¼šâ€œä½ ä»¬å›¢é˜Ÿæ€ä¹ˆåšå¤šäººåä½œï¼Ÿâ€ ğŸ‘‰ å°å›¢é˜Ÿï¼šGitHub Flowï¼›å¤§å›¢é˜Ÿï¼šGit Flowï¼›å¤§å‚ DevOpsï¼šTrunk-basedã€‚
- Git Flow ç¨³å¥ä½†å¤æ‚ï¼ŒTrunk-based ç°ä»£é«˜æ•ˆã€‚

---
