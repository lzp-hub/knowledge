## 一、Node.js 基础

### 1. Node.js 的事件驱动与非阻塞 I/O 🔥

**一句话回答**
Node.js 基于事件驱动和非阻塞 I/O，适合高并发 I/O 密集型应用。

**要点**

- 单线程 + 事件循环。
- 非阻塞 I/O。
- 适合高并发。

**详细回答**
Node.js 使用 **libuv** 实现事件循环，I/O 操作通过回调/Promise 处理，避免阻塞主线程。
适合 Web 服务、API 网关，不适合 CPU 密集型任务。

**扩展/对比**

- 面试官可能问：“Node.js 单线程为什么能高并发？” 👉 因为 I/O 操作交给内核处理，线程只负责调度。

---

### 2. Node.js 的事件循环与浏览器的区别

**一句话回答**
浏览器只有宏/微任务，Node.js 事件循环有更多阶段。

**要点**

- 浏览器：宏任务 + 微任务。
- Node.js：timers、I/O callbacks、idle、poll、check、close。

**详细回答**
Node.js 在执行栈清空后，进入 **timers → poll → check** 等阶段，Promise 的回调依旧在微任务队列中优先执行。

**扩展/对比**

- 面试官可能问：“setImmediate 和 setTimeout 区别？” 👉 setImmediate 在 check 阶段，setTimeout 在 timers 阶段。

---

### 3. CommonJS vs ESModule 🔥

**一句话回答**
CommonJS 是运行时同步加载，ESModule 是编译时静态分析，支持 tree-shaking。

**要点**

- CommonJS：require/module.exports。
- ESM：import/export。
- Node.js 14+ 原生支持 ESM。

**详细回答**

- CommonJS 是同步加载，不适合浏览器。
- ESM 静态依赖分析，支持按需加载与优化。

**扩展/对比**

- 面试官常问：“为什么 Node.js 要支持 ESM？” 👉 与前端统一，支持 tree-shaking。

---

## 二、API 与 BFF（Backend For Frontend）

### 4. Next.js API Routes 的应用

**一句话回答**
API Routes 让 Next.js 提供轻量级后端能力，适合 BFF 场景。

**要点**

- `pages/api/*` 或 `app/api/*/route.ts`。
- 返回 JSON。
- 可用于代理 API、鉴权。

**详细回答**

```ts
export default function handler(req, res) {
  res.status(200).json({ msg: "hello" });
}
```

**扩展/对比**

- 面试官可能问：“API Routes 能替代后端吗？” 👉 适合轻量逻辑，复杂系统还是需要专门后端。

---

### 5. BFF 的概念 🔥

**一句话回答**
BFF 是前端专属的后端层，用于聚合和裁剪数据，避免前端多次调用。

**要点**

- 聚合多个服务。
- 数据裁剪。
- 减少前端负担。

**详细回答**

- BFF 位于前端与后端中间。
- 将多个后端服务整合为前端需要的 API。
- 常用技术栈：Node.js + Express/Koa + Next.js API Routes。

**扩展/对比**

- 面试官可能问：“BFF 为什么比直接调后端好？” 👉 避免前端多次请求，降低耦合。

---

## 三、WebSocket 与实时通信

### 6. WebSocket 的原理 🔥

**一句话回答**
WebSocket 是基于 TCP 的全双工通信协议，适合实时场景。

**要点**

- 基于 TCP。
- 全双工。
- 握手阶段走 HTTP，之后升级。

**详细回答**

- WebSocket 建立时用 HTTP 请求握手。
- 成功后升级为持久化 TCP 连接。
- 客户端和服务端可互相推送消息。

**扩展/对比**

- 面试官常问：“WebSocket 和轮询的区别？” 👉 WebSocket 是实时推送，轮询需要频繁请求。

---

### 7. 如何实现心跳机制

**一句话回答**
心跳包是定时发送 ping/pong，确保连接存活。

**要点**

- 定时发送心跳。
- 断线重连。
- 超时关闭连接。

**详细回答**

```js
setInterval(() => ws.send("ping"), 30000);
ws.on("pong", () => console.log("alive"));
```

**扩展/对比**

- 面试官可能问：“如果客户端断网怎么办？” 👉 服务端超时检测 + 自动重连。

---

## 四、服务端部署与云服务

### 8. Docker 的作用与优势 🔥

**一句话回答**
Docker 提供轻量虚拟化，保证跨环境一致性。

**要点**

- 镜像 → 容器。
- 一次构建，到处运行。
- CI/CD 友好。

**详细回答**

- Docker 将应用和依赖打包进镜像。
- 容器运行时与宿主环境隔离。
- 结合 CI/CD 可自动部署。

**扩展/对比**

- 面试官常问：“Docker 和虚拟机的区别？” 👉 Docker 共享宿主机内核，启动更快。

---

### 9. 多环境配置（dev/staging/prod）

**一句话回答**
通过环境变量区分不同环境配置，避免硬编码。

**要点**

- `.env` 文件。
- CI/CD 注入变量。
- 配置中心。

**详细回答**

- Next.js 中可用 `.env.local`、`.env.production`。
- CI 部署时注入环境变量，保证安全。

**扩展/对比**

- 面试官可能问：“如何避免泄漏 API key？” 👉 不要写死在代码里，用环境变量。

---

### 10. AWS S3 / SQS 的应用场景 🔥

**一句话回答**
S3 用于对象存储，SQS 用于消息队列解耦系统。

**要点**

- S3：存储静态文件、图片、视频。
- SQS：异步任务队列。

**详细回答**

- S3 适合静态资源托管，配合 CDN。
- SQS 用于消息解耦，比如订单支付回调。

**扩展/对比**

- 面试官可能问：“S3 和数据库的区别？” 👉 S3 是文件存储，不是结构化数据存储。
